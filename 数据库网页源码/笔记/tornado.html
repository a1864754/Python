<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport">
    <title>tornado</title>


    <style type="text/css">
        body {
            font-family: Helvetica, arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            padding-top: 10px;
            padding-bottom: 10px;
            background-color: white;
            padding: 30px;
        }

        body > *:first-child {
            margin-top: 0 !important;
        }

        body > *:last-child {
            margin-bottom: 0 !important;
        }

        a {
            color: #4183C4;
        }

        a.absent {
            color: #cc0000;
        }

        a.anchor {
            display: block;
            padding-left: 30px;
            margin-left: -30px;
            cursor: pointer;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
        }

        h1, h2, h3, h4, h5, h6 {
            margin: 20px 0 10px;
            padding: 0;
            font-weight: bold;
            -webkit-font-smoothing: antialiased;
            cursor: text;
            position: relative;
        }

        h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
            background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
            text-decoration: none;
        }

        h1 tt, h1 code {
            font-size: inherit;
        }

        h2 tt, h2 code {
            font-size: inherit;
        }

        h3 tt, h3 code {
            font-size: inherit;
        }

        h4 tt, h4 code {
            font-size: inherit;
        }

        h5 tt, h5 code {
            font-size: inherit;
        }

        h6 tt, h6 code {
            font-size: inherit;
        }

        h1 {
            font-size: 28px;
            color: black;
        }

        h2 {
            font-size: 24px;
            border-bottom: 1px solid #cccccc;
            color: black;
        }

        h3 {
            font-size: 18px;
        }

        h4 {
            font-size: 16px;
        }

        h5 {
            font-size: 14px;
        }

        h6 {
            color: #777777;
            font-size: 14px;
        }

        p, blockquote, ul, ol, dl, li, table, pre {
            margin: 15px 0;
        }

        hr {
            background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
            border: 0 none;
            color: #cccccc;
            height: 4px;
            padding: 0;
        }

        body > h2:first-child {
            margin-top: 0;
            padding-top: 0;
        }

        body > h1:first-child {
            margin-top: 0;
            padding-top: 0;
        }

        body > h1:first-child + h2 {
            margin-top: 0;
            padding-top: 0;
        }

        body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
            margin-top: 0;
            padding-top: 0;
        }

        a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
            margin-top: 0;
            padding-top: 0;
        }

        h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
            margin-top: 0;
        }

        li p.first {
            display: inline-block;
        }

        li {
            margin: 0;
        }

        ul, ol {
            padding-left: 30px;
        }

        ul :first-child, ol :first-child {
            margin-top: 0;
        }

        dl {
            padding: 0;
        }

        dl dt {
            font-size: 14px;
            font-weight: bold;
            font-style: italic;
            padding: 0;
            margin: 15px 0 5px;
        }

        dl dt:first-child {
            padding: 0;
        }

        dl dt > :first-child {
            margin-top: 0;
        }

        dl dt > :last-child {
            margin-bottom: 0;
        }

        dl dd {
            margin: 0 0 15px;
            padding: 0 15px;
        }

        dl dd > :first-child {
            margin-top: 0;
        }

        dl dd > :last-child {
            margin-bottom: 0;
        }

        blockquote {
            border-left: 4px solid #dddddd;
            padding: 0 15px;
            color: #777777;
        }

        blockquote > :first-child {
            margin-top: 0;
        }

        blockquote > :last-child {
            margin-bottom: 0;
        }

        table {
            padding: 0;
            border-collapse: collapse;
        }

        table tr {
            border-top: 1px solid #cccccc;
            background-color: white;
            margin: 0;
            padding: 0;
        }

        table tr:nth-child(2n) {
            background-color: #f8f8f8;
        }

        table tr th {
            font-weight: bold;
            border: 1px solid #cccccc;
            margin: 0;
            padding: 6px 13px;
        }

        table tr td {
            border: 1px solid #cccccc;
            margin: 0;
            padding: 6px 13px;
        }

        table tr th :first-child, table tr td :first-child {
            margin-top: 0;
        }

        table tr th :last-child, table tr td :last-child {
            margin-bottom: 0;
        }

        img {
            max-width: 100%;
        }

        span.frame {
            display: block;
            overflow: hidden;
        }

        span.frame > span {
            border: 1px solid #dddddd;
            display: block;
            float: left;
            overflow: hidden;
            margin: 13px 0 0;
            padding: 7px;
            width: auto;
        }

        span.frame span img {
            display: block;
            float: left;
        }

        span.frame span span {
            clear: both;
            color: #333333;
            display: block;
            padding: 5px 0 0;
        }

        span.align-center {
            display: block;
            overflow: hidden;
            clear: both;
        }

        span.align-center > span {
            display: block;
            overflow: hidden;
            margin: 13px auto 0;
            text-align: center;
        }

        span.align-center span img {
            margin: 0 auto;
            text-align: center;
        }

        span.align-right {
            display: block;
            overflow: hidden;
            clear: both;
        }

        span.align-right > span {
            display: block;
            overflow: hidden;
            margin: 13px 0 0;
            text-align: right;
        }

        span.align-right span img {
            margin: 0;
            text-align: right;
        }

        span.float-left {
            display: block;
            margin-right: 13px;
            overflow: hidden;
            float: left;
        }

        span.float-left span {
            margin: 13px 0 0;
        }

        span.float-right {
            display: block;
            margin-left: 13px;
            overflow: hidden;
            float: right;
        }

        span.float-right > span {
            display: block;
            overflow: hidden;
            margin: 13px auto 0;
            text-align: right;
        }

        code, tt {
            margin: 0 2px;
            padding: 0 5px;
            white-space: nowrap;
            border: 1px solid #eaeaea;
            background-color: #f8f8f8;
            border-radius: 3px;
        }

        pre code {
            margin: 0;
            padding: 0;
            white-space: pre;
            border: none;
            background: transparent;
        }

        .highlight pre {
            background-color: #f8f8f8;
            border: 1px solid #cccccc;
            font-size: 13px;
            line-height: 19px;
            overflow: auto;
            padding: 6px 10px;
            border-radius: 3px;
        }

        pre {
            background-color: #f8f8f8;
            border: 1px solid #cccccc;
            font-size: 13px;
            line-height: 19px;
            overflow: auto;
            padding: 6px 10px;
            border-radius: 3px;
        }

        pre code, pre tt {
            background-color: transparent;
            border: none;
        }

        sup {
            font-size: 0.83em;
            vertical-align: super;
            line-height: 0;
        }

        kbd {
            display: inline-block;
            padding: 3px 5px;
            font-size: 11px;
            line-height: 10px;
            color: #555;
            vertical-align: middle;
            background-color: #fcfcfc;
            border: solid 1px #ccc;
            border-bottom-color: #bbb;
            border-radius: 3px;
            box-shadow: inset 0 -1px 0 #bbb
        }

        * {
            -webkit-print-color-adjust: exact;
        }

        @media screen and (min-width: 914px) {
            body {
                width: 854px;
                margin: 0 auto;
            }
        }

        @media print {
            table, pre {
                page-break-inside: avoid;
            }

            pre {
                word-wrap: break-word;
            }
        }
    </style>


</head>

<body>

<h1 id="toc_0">1.虚拟环境</h1>

<h2 id="toc_1">1.1 虚拟环境的创建</h2>

<div>
    <pre><code class="language-none">mkvirtualenv tornado_py3 -p python3</code></pre>
</div>

<h2 id="toc_2">1.2 安装tornado</h2>

<div>
    <pre><code class="language-none">pip install tornado</code></pre>
</div>

<h2 id="toc_3">1.3 虚拟环境其他的操作</h2>

<div><pre><code class="language-none"># 虚拟环境
mkvirtualenv  # 创建虚拟环境
rmvirtualenv  # 删除虚拟环境
workon  # 进入虚拟环境、查看所有虚拟环境
deactivate  # 退出虚拟环境

# pip
pip install  # 安装依赖包
pip uninstall  # 卸载依赖包
pip list  # 查看已安装的依赖库</code></pre>
</div>

<h1 id="toc_4">2. 搭建项目</h1>

<div><pre><code class="language-none"># 导包
import tornado.ioloop
import tornado.web

# 类似django中视图
class MainHandler(tornado.web.RequestHandler):
        # 这里写请求的方式
    def get(self):

        self.write(&quot;Hello, world&quot;)

# 程序配置
def make_app():
        # 这里配置路由功能
    return tornado.web.Application([
        (r&quot;/&quot;, MainHandler),
    ])

# 程序入口
if __name__ == &quot;__main__&quot;:
        # 加载配置
    app = make_app()
    # 设置监听
    app.listen(8888)
    # 开启服务, ioloop 实际上是对 epoll 的封装
    tornado.ioloop.IOLoop.current().start()</code></pre>
</div>

<h1 id="toc_5">3.完成请求的方式</h1>

<div><pre><code class="language-none"># 类似django中视图
class MainHandler(tornado.web.RequestHandler):
    # 得到数据
    def get(self):
        # 这里就是返回的内容
        self.write(&quot;得到数据&quot;)
    # 添加新的数据
    def post(self):
        self.write(&quot;添加新的数据&quot;)

    # 修改数据
    def put(self):
        self.write(&quot;修改数据&quot;)

    # 删除数据
    def delete(self):
        self.write(&quot;删除数据&quot;)</code></pre>
</div>

<h1 id="toc_6">4. 设置静态文件</h1>

<div><pre><code class="language-none"># 程序配置
def make_app():
    return tornado.web.Application([
        (r&quot;/books/&quot;, MainHandler),
    ],
        static_path=&quot;./static&quot; # 配置静态文件夹路径
    )</code></pre>
</div>

<h1 id="toc_7">5. 配置模板</h1>

<h2 id="toc_8">5.1 加载模板配置</h2>

<div><pre><code class="language-none">def make_app():
return tornado.web.Application([
    (r&quot;/books/&quot;, MainHandler),
],
    static_path=&quot;./static&quot;, # 配置静态文件夹路径
    template_path = &quot;./templates&quot;,# 配置模板路径
)</code></pre>
</div>

<h2 id="toc_9">5.2 定义模板</h2>

<div><pre><code class="language-none">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;{{ show }}&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>

<h2 id="toc_10">5.3 渲染模板</h2>

<h4 id="toc_11">模板内容使用render返回内容</h4>

<div><pre><code class="language-none"># 类似django中视图
class MainHandler(tornado.web.RequestHandler):
    # 得到数据
    def get(self):
        # 这里就是返回的内容
        self.render(&quot;index.html&quot;,show=&#39;显示内容&#39;)</code></pre>
</div>

<h1 id="toc_12">6 加载前端给的数据</h1>

<h2 id="toc_13">6.1 加载前端给个模板文件</h2>

<h2 id="toc_14">6.2 加载前端给的前端静态资源</h2>

<h1 id="toc_15">7. 数据库操作</h1>

<h1 id="toc_16">7.1 数据库初始化</h1>

<div><pre><code class="language-none">-- 创建数据库
create database book_manager charset=utf8;

-- 使用数据库
use book_manager;

-- 创建表
CREATE TABLE books(id int UNSIGNED PRIMARY KEY AUTO_INCREMENT ,btitle VARCHAR(30) not NULL ,bauthor VARCHAR(30) NOT NULL ,bperson VARCHAR(30),bpub_date DATE NOT NULL ,bread INT UNSIGNED,bcomment INT UNSIGNED);


-- 插入数据
insert into books(btitle, bauthor, bperson, bpub_date, bread, bcomment) VALUES
(&#39;红楼梦&#39;,&#39;曹雪芹&#39;,&#39;宝⽟&#39;,&#39;1980-5-1&#39;,12,34),
(&#39;⻄游记&#39;,&#39;施耐安&#39;,&#39;悟空&#39;,&#39;1986-7-24&#39;,36,50),
(&#39;⽔浒传&#39;,&#39;吴承恩&#39;,&#39;林冲&#39;,&#39;1995-12-24&#39;,20,80),
(&#39;三国演义&#39;,&#39;罗贯中&#39;,&#39;曹操&#39;,&#39;1980-5-1&#39;,58,24);</code></pre>
</div>

<h1 id="toc_17">7.2 安装pymysql</h1>

<div>
    <pre><code class="language-none">pip install pymysql</code></pre>
</div>

<h1 id="toc_18">8. 使用同步的方式操作数据</h1>

<h2 id="toc_19">8.1 get请求</h2>

<h2 id="toc_20">8.1.1get请求处理</h2>

<div><pre><code class="language-none">class MainHandler(tornado.web.RequestHandler):
    # 得到数据
    # 异步方法
    def get(self):

        # 1. 从数据库得到数据
        # 1.1连接数据库
        # 创建Connection连接
        conn = connect(host=&#39;localhost&#39;, port=3306, database=&#39;book_manager&#39;, user=&#39;root&#39;, password=&#39;mysql&#39;, charset=&#39;utf8&#39;)
        # 获得Cursor对象
        cs1 = conn.cursor()

        # 1.2 执行查询的sql语句
        cs1.execute(&quot;select * from books;&quot;)
        # 得到数据库的数据
        data = cs1.fetchall()

        # 1.3 关闭
        cs1.close()
        conn.close()

        # 操作
        #for temp in data:
        #  print(temp)



        # 返回数据
        self.render(&#39;index.html&#39;,show_list = data)</code></pre>
</div>

<h3 id="toc_21">8.1.2模板数据展示</h3>

<div><pre><code class="language-none">     &lt;!--这里动态添加数据--&gt;
{% for temp in show_list%}
&lt;tr&gt;
    &lt;td&gt;&lt;input class=&quot;idInput&quot; type=&quot;text&quot; value=&quot;{{temp[0]}}&quot;&gt;&lt;/td&gt;
    &lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;{{temp[1]}}&quot;&gt;&lt;/td&gt;
    &lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;{{temp[2]}}&quot;&gt;&lt;/td&gt;
    &lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;{{temp[3]}}&quot;&gt;&lt;/td&gt;
    &lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;{{temp[4]}}&quot;&gt;&lt;/td&gt;
    &lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;{{temp[5]}}&quot;&gt;&lt;/td&gt;
    &lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;{{temp[6]}}&quot;&gt;&lt;/td&gt;
    &lt;td class=&quot;del&quot;&gt;&lt;input type=&quot;button&quot; value=&quot; 删 除 &quot;&gt;&lt;/td&gt;
    &lt;td class=&quot;update&quot;&gt;&lt;input type=&quot;button&quot; value=&quot; 修 改 &quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
{%end%}</code></pre>
</div>

<h2 id="toc_22">8.2 post请求</h2>

<div><pre><code class="language-none">def post(self):
    # 得到请求的数据
    # 使用元组
    params_list = list()
    params_list.append(self.get_argument(&#39;btitle&#39;))
    params_list.append(self.get_argument(&#39;bauthor&#39;))
    params_list.append(self.get_argument(&#39;bperson&#39;))
    params_list.append(self.get_argument(&#39;bpub_date&#39;))
    params_list.append(self.get_argument(&#39;bread&#39;))
    params_list.append(self.get_argument(&#39;bcomment&#39;))

    print(params_list)

    # 1. 从数据库得到数据
    # 1.1连接数据库
    # 创建Connection连接
    conn = connect(host=&#39;localhost&#39;, port=3306, database=&#39;book_manager&#39;, user=&#39;root&#39;, password=&#39;mysql&#39;,
                   charset=&#39;utf8&#39;)
    # 获得Cursor对象
    cs1 = conn.cursor()

    # 1.2 执行查询的sql语句
    cs1.execute(&quot;insert into books(btitle,bauthor,bperson,bpub_date,bread,bcomment) values(%s,%s,%s,%s,%s,%s)&quot;,
                params_list)
    # 得到数据库的数据
    conn.commit()

    # 1.3 关闭
    cs1.close()
    conn.close()

    self.write({&quot;data&quot;: &quot;success&quot;})</code></pre>
</div>

<h2 id="toc_23">8.3put请求</h2>

<div><pre><code class="language-none">def put(self):
    # 得到数据
    body_data = self.request.body.decode(&quot;utf-8&quot;)

    # 解析成字典
    params_dict = json.loads(body_data)

    # 1. 从数据库得到数据
    # 1.1连接数据库
    # 创建Connection连接
    conn = connect(host=&#39;localhost&#39;, port=3306, database=&#39;book_manager&#39;, user=&#39;root&#39;, password=&#39;mysql&#39;,
                   charset=&#39;utf8&#39;)
    # 获得Cursor对象
    cs1 = conn.cursor()

    # btitle, bauthor, bperson, bpub_date, bread, bcomment
    # 1.2 执行查询的sql语句

    cs1.execute(
        &quot;update books set btitle = %(btitle)s,bauthor = %(bauthor)s,bperson = %(bperson)s,bpub_date =%(bpub_date)s,bread = %(bread)s,bcomment = %(bcomment)s where id = %(id)s&quot;,
        params_dict
        )
    # 得到数据库的数据
    conn.commit()

    # 1.3 关闭
    cs1.close()
    conn.close()

    self.write({&quot;data&quot;:&quot;success&quot;})</code></pre>
</div>

<h2 id="toc_24">8.4 delete 请求</h2>

<div><pre><code class="language-none">def delete(self):
        # 得到数据
        body_data = self.request.body.decode(&quot;utf-8&quot;)

        # 解析成字典
        params_dict = json.loads(body_data)

        # 1. 从数据库得到数据
        # 1.1连接数据库
        # 创建Connection连接
        conn = connect(host=&#39;localhost&#39;, port=3306, database=&#39;book_manager&#39;, user=&#39;root&#39;, password=&#39;mysql&#39;,
                       charset=&#39;utf8&#39;)
        # 获得Cursor对象
        cs1 = conn.cursor()

        # 1.2 执行查询的sql语句
        cs1.execute(&quot;delete from books where id = %(id)s&quot;, params_dict)

        conn.commit()

        # 1.3 关闭
        cs1.close()
        conn.close()

        self.write({&quot;data&quot;:&quot;success&quot;})</code></pre>
</div>

<h1 id="toc_25">9. 异步请求改造</h1>

<div><pre><code class="language-none">class MainHandler(tornado.web.RequestHandler):
# 得到数据
# 异步方法
async def get(self):
    print(&#39;get请求&#39;)
    # 等待3秒
    await asyncio.sleep(3)

    # 这里就是返回的内容
    self.render(&quot;index.html&quot;,show=&#39;显示内容&#39;)</code></pre>
</div>

<h1 id="toc_26">10异步</h1>

<h2 id="toc_27">10.1 安装模块</h2>

<div>
    <pre><code class="language-none">pip3 install aiomysql</code></pre>
</div>

<h2 id="toc_28">把所有请求改成异步请求</h2>

<h3 id="toc_29">只需要方法前加async 再耗时返回时使用await返回</h3>

<div><pre><code class="language-none">class MainHandler(tornado.web.RequestHandler):
# 得到数据
# 异步方法
async def get(self):
    # 1. 从数据库得到数据
    # 1.1连接数据库
    # 创建Connection连接
    conn = await aiomysql.connect(host=&#39;localhost&#39;, port=3306, db=&#39;book_manager&#39;, user=&#39;root&#39;, password=&#39;mysql&#39;,
                   charset=&#39;utf8&#39;)
    # 获得Cursor对象
    cs1 =  await conn.cursor()

    # 1.2 执行查询的sql语句
    await cs1.execute(&quot;select * from books;&quot;)
    # 得到数据库的数据
    data = await cs1.fetchall()

    # 1.3 关闭
    await cs1.close()
    conn.close()

    # 操作
    # for temp in data:
    #   print(temp)


    self.render(&#39;index.html&#39;, show_list=data)

async def post(self):
    # 得到请求的数据
    # 使用元组
    params_list = list()
    params_list.append(self.get_argument(&#39;btitle&#39;))
    params_list.append(self.get_argument(&#39;bauthor&#39;))
    params_list.append(self.get_argument(&#39;bperson&#39;))
    params_list.append(self.get_argument(&#39;bpub_date&#39;))
    params_list.append(self.get_argument(&#39;bread&#39;))
    params_list.append(self.get_argument(&#39;bcomment&#39;))

    print(params_list)

    # 1. 从数据库得到数据
    # 1.1连接数据库
    # 创建Connection连接
    conn = await aiomysql.connect(host=&#39;localhost&#39;, port=3306, db=&#39;book_manager&#39;, user=&#39;root&#39;, password=&#39;mysql&#39;,
                   charset=&#39;utf8&#39;)
    # 获得Cursor对象
    cs1 = await  conn.cursor()

    # 1.2 执行查询的sql语句
    await cs1.execute(&quot;insert into books(btitle,bauthor,bperson,bpub_date,bread,bcomment) values(%s,%s,%s,%s,%s,%s)&quot;,
                params_list)
    # 得到数据库的数据
    await conn.commit()

    # 1.3 关闭
    await cs1.close()
    conn.close()

    self.write({&quot;data&quot;: &quot;success&quot;})

async def put(self):
    # 得到数据
    body_data = self.request.body.decode(&quot;utf-8&quot;)

    # 解析成字典
    params_dict = json.loads(body_data)

    # 1. 从数据库得到数据
    # 1.1连接数据库
    # 创建Connection连接
    conn = await aiomysql.connect(host=&#39;localhost&#39;, port=3306, db=&#39;book_manager&#39;, user=&#39;root&#39;, password=&#39;mysql&#39;,
                   charset=&#39;utf8&#39;)
    # 获得Cursor对象
    cs1 = await  conn.cursor()

    # btitle, bauthor, bperson, bpub_date, bread, bcomment
    # 1.2 执行查询的sql语句

    await cs1.execute(
        &quot;update books set btitle = %(btitle)s,bauthor = %(bauthor)s,bperson = %(bperson)s,bpub_date =%(bpub_date)s,bread = %(bread)s,bcomment = %(bcomment)s where id = %(id)s&quot;,
        params_dict
    )
    # 得到数据库的数据
    await conn.commit()

    # 1.3 关闭
    await cs1.close()
    conn.close()

    self.write({&quot;data&quot;: &quot;success&quot;})

async def delete(self):
    # 得到数据
    body_data = self.request.body.decode(&quot;utf-8&quot;)

    # 解析成字典
    params_dict = json.loads(body_data)

    # 1. 从数据库得到数据
    # 1.1连接数据库
    # 创建Connection连接
    conn = await aiomysql.connect(host=&#39;localhost&#39;, port=3306, db=&#39;book_manager&#39;, user=&#39;root&#39;, password=&#39;mysql&#39;,
                   charset=&#39;utf8&#39;)
    # 获得Cursor对象
    cs1 = await  conn.cursor()

    # 1.2 执行查询的sql语句
    await cs1.execute(&quot;delete from books where id = %(id)s&quot;, params_dict)

    await conn.commit()

    # 1.3 关闭
    await cs1.close()
    conn.close()

    self.write({&quot;data&quot;:&quot;success&quot;})</code></pre>
</div>


</body>

</html>
